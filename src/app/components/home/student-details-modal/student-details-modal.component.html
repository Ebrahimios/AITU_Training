<!-- Modal Overlay -->
<div class="modal-overlay">
  <!-- Bootstrap Modal -->
  <div class="modal fade show" id="studentDetailsModal" tabindex="-1" role="dialog" aria-labelledby="studentDetailsModalLabel" aria-hidden="true" style="display: block;">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <div class="header-content">
            <div class="student-title">
              <h2>{{student.name}}</h2>
              <span class="student-code">{{student.code}}</span>
            </div>
            <div class="header-actions">
              <button class="btn-close" (click)="close()" [disabled]="isLoading">
                <span *ngIf="!isLoading"><i class="bi bi-x-lg"></i></span>
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
              </button>
            </div>
          </div>
          <div class="status-badge" [ngClass]="{'status-active': student.state === 'Active', 'status-inactive': student.state === 'Inactive'}">
            {{student.state}}
          </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs-navigation">
          <button class="tab-button" [class.active]="activeTab === 'basic'" (click)="activeTab = 'basic'">
            <i class="bi bi-person"></i> Basic Info
          </button>
          <button class="tab-button" [class.active]="activeTab === 'progress'" (click)="activeTab = 'progress'">
            <i class="bi bi-graph-up"></i> Progress & Performance
          </button>
          <button class="tab-button" [class.active]="activeTab === 'evaluation'" (click)="activeTab = 'evaluation'" *ngIf="isSupervisor">
            <i class="bi bi-clipboard-check"></i> Evaluation
          </button>
        </div>

        <div class="modal-body">
          <!-- Basic Info Tab -->
          <div class="tab-content" [class.active]="activeTab === 'basic'">
            <div class="info-section">
              <div class="info-header">
                <h3>Basic Information</h3>
                <button type="button" class="btn btn-primary" (click)="toggleEditMode()" [disabled]="isLoading">
                  <span *ngIf="!isLoading">
                    <i class="bi" [ngClass]="isEditMode ? 'bi-check-lg' : 'bi-pencil'"></i>
                    {{ isEditMode ? 'Save' : 'Edit' }}
                  </span>
                  <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                </button>
              </div>
              <div class="info-grid">
                <div class="info-item">
                  <span class="label">Student Name:</span>
                  <span class="value" *ngIf="!isEditMode">{{ student.name }}</span>
                  <input type="text" class="form-control" *ngIf="isEditMode" [(ngModel)]="student.name">
                </div>
                <div class="info-item">
                  <span class="label">Student Code:</span>
                  <span class="value" *ngIf="!isEditMode">{{ student.code }}</span>
                  <input type="text" class="form-control" *ngIf="isEditMode" [(ngModel)]="student.code" readonly>
                </div>
                <div class="info-item">
                  <span class="label">Email:</span>
                  <span class="value" *ngIf="!isEditMode">{{ student.email }}</span>
                  <input type="email" class="form-control" *ngIf="isEditMode" [(ngModel)]="student.email">
                </div>
                <div class="info-item">
                  <span class="label">Phone Number:</span>
                  <span class="value" *ngIf="!isEditMode">{{ student.phone }}</span>
                  <input type="tel" class="form-control" *ngIf="isEditMode" [(ngModel)]="student.phone">
                </div>
                <div class="info-item">
                  <span class="label">Birth Date:</span>
                  <span class="value" *ngIf="!isEditMode">{{ student.birthDate | date }}</span>
                  <input type="date" class="form-control" *ngIf="isEditMode" [(ngModel)]="birthDateString">
                </div>
                <div class="info-item">
                  <span class="label">Gender:</span>
                  <span class="value" *ngIf="!isEditMode">{{ student.gender }}</span>
                  <select class="form-select" *ngIf="isEditMode" [(ngModel)]="student.gender">
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                  </select>
                </div>
                <div class="info-item">
                  <span class="label">Address:</span>
                  <span class="value" *ngIf="!isEditMode">{{ student.address }}</span>
                  <input type="text" class="form-control" *ngIf="isEditMode" [(ngModel)]="student.address">
                </div>
                <div class="info-item">
                  <span class="label">Department:</span>
                  <span class="value" *ngIf="!isEditMode">{{ student.department }}</span>
                  <select class="form-select" *ngIf="isEditMode" [(ngModel)]="student.department">
                    <option value="Information Technology">Information Technology</option>
                    <option value="Mechanics">Mechanics</option>
                    <option value="Electrical">Electrical</option>
                  </select>
                </div>
                <div class="info-item">
                  <span class="label">Factory:</span>
                  <span class="value" *ngIf="!isEditMode">{{ student.factory }}</span>
                  <select class="form-select" *ngIf="isEditMode" [(ngModel)]="student.factory">
                    <option value="Factory A">Factory A</option>
                    <option value="Factory B">Factory B</option>
                    <option value="Factory C">Factory C</option>
                  </select>
                </div>
                <div class="info-item">
                  <span class="label">Supervisor:</span>
                  <span class="value" *ngIf="!isEditMode">{{ student.supervisor || '-' }}</span>
                  <select class="form-select" *ngIf="isEditMode" [(ngModel)]="student.supervisor">
                    <option [ngValue]="null">None</option>
                    <option *ngFor="let supervisorName of supervisorNames" [value]="supervisorName">{{supervisorName}}</option>
                  </select>
                </div>
                <div class="info-item">
                  <span class="label">Factory Type:</span>
                  <span class="value" *ngIf="!isEditMode">{{ student.factoryType ? 'Type A' : 'Type B' }}</span>
                  <select class="form-select" *ngIf="isEditMode" [(ngModel)]="student.factoryType">
                    <option [ngValue]="true">Type A</option>
                    <option [ngValue]="false">Type B</option>
                  </select>
                </div>
                <div class="info-item">
                  <span class="label">Stage:</span>
                  <span class="value" *ngIf="!isEditMode">{{ student.stage }}</span>
                  <select class="form-select" *ngIf="isEditMode" [(ngModel)]="student.stage">
                    <option value="School">School</option>
                    <option value="Institute">Institute</option>
                    <option value="Faculty">Faculty</option>
                  </select>
                </div>
                <div class="info-item">
                  <span class="label">National ID:</span>
                  <span class="value" *ngIf="!isEditMode">{{ student.nationalID }}</span>
                  <input type="text" class="form-control" *ngIf="isEditMode" [(ngModel)]="student.nationalID">
                </div>
                <div class="info-item">
                  <span class="label">Status:</span>
                  <span class="value" *ngIf="!isEditMode" [ngClass]="{'status-active': student.state === 'Active', 'status-inactive': student.state === 'Inactive'}">
                    {{ student.state }}
                  </span>
                  <select class="form-select" *ngIf="isEditMode" [(ngModel)]="student.state">
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                  </select>
                </div>
                <div class="info-item">
                  <span class="label">Grade:</span>
                  <span class="value" *ngIf="!isEditMode">{{ student.grade }}</span>
                  <input type="number" class="form-control" *ngIf="isEditMode" [(ngModel)]="student.grade">
                </div>
              </div>
            </div>
          </div>

          <!-- Progress & Performance Tab -->
          <div class="tab-content" [class.active]="activeTab === 'progress'">
            <div class="progress-section" *ngIf="!isLoading && student.progress !== undefined">
              <h3>Progress & Performance</h3>
              <div class="progress-grid">
                <div class="progress-item">
                  <div class="progress-header">
                    <span class="label">Overall Progress</span>
                    <span class="percentage">{{ student.progress }}%</span>
                  </div>
                  <div class="progress">
                    <div class="progress-bar"
                         [ngClass]="{
                           'bg-success': student.progress! >= 80,
                           'bg-warning': student.progress! >= 60 && student.progress! < 80,
                           'bg-danger': student.progress! < 60
                         }"
                         role="progressbar"
                         [style.width.%]="student.progress!"
                         [attr.aria-valuenow]="student.progress"
                         aria-valuemin="0"
                         aria-valuemax="100">
                    </div>
                  </div>
                  <span class="status">{{ getPerformanceStatus(student.progress) }}</span>
                </div>

                <div class="progress-item">
                  <div class="progress-header">
                    <span class="label">Attendance</span>
                    <span class="percentage">{{ student.attendance }}%</span>
                  </div>
                  <div class="progress">
                    <div class="progress-bar"
                         [ngClass]="{
                           'bg-success': student.attendance! >= 80,
                           'bg-warning': student.attendance! >= 60 && student.attendance! < 80,
                           'bg-danger': student.attendance! < 60
                         }"
                         role="progressbar"
                         [style.width.%]="student.attendance!"
                         [attr.aria-valuenow]="student.attendance"
                         aria-valuemin="0"
                         aria-valuemax="100">
                    </div>
                  </div>
                </div>
              </div>

              <div class="performance-grid" *ngIf="student.performance">
                <div class="progress-item">
                  <div class="progress-header">
                    <span class="label">Technical Skills</span>
                    <span class="percentage">{{ student.performance.technical }}%</span>
                  </div>
                  <div class="progress">
                    <div class="progress-bar"
                         [ngClass]="{
                           'bg-success': student.performance.technical >= 80,
                           'bg-warning': student.performance.technical >= 60 && student.performance.technical < 80,
                           'bg-danger': student.performance.technical < 60
                         }"
                         role="progressbar"
                         [style.width.%]="student.performance.technical"
                         [attr.aria-valuenow]="student.performance.technical"
                         aria-valuemin="0"
                         aria-valuemax="100">
                    </div>
                  </div>
                </div>

                <div class="progress-item">
                  <div class="progress-header">
                    <span class="label">Communication</span>
                    <span class="percentage">{{ student.performance.communication }}%</span>
                  </div>
                  <div class="progress">
                    <div class="progress-bar"
                         [ngClass]="{
                           'bg-success': student.performance.communication >= 80,
                           'bg-warning': student.performance.communication >= 60 && student.performance.communication < 80,
                           'bg-danger': student.performance.communication < 60
                         }"
                         role="progressbar"
                         [style.width.%]="student.performance.communication"
                         [attr.aria-valuenow]="student.performance.communication"
                         aria-valuemin="0"
                         aria-valuemax="100">
                    </div>
                  </div>
                </div>

                <div class="progress-item">
                  <div class="progress-header">
                    <span class="label">Teamwork</span>
                    <span class="percentage">{{ student.performance.teamwork }}%</span>
                  </div>
                  <div class="progress">
                    <div class="progress-bar"
                         [ngClass]="{
                           'bg-success': student.performance.teamwork >= 80,
                           'bg-warning': student.performance.teamwork >= 60 && student.performance.teamwork < 80,
                           'bg-danger': student.performance.teamwork < 60
                         }"
                         role="progressbar"
                         [style.width.%]="student.performance.teamwork"
                         [attr.aria-valuenow]="student.performance.teamwork"
                         aria-valuemin="0"
                         aria-valuemax="100">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="loading-container" *ngIf="isLoading">
              <div class="spinner"></div>
              <p>Loading progress data...</p>
            </div>
          </div>

          <!-- Evaluation Tab -->
          <div class="tab-content" [class.active]="activeTab === 'evaluation'">
            <div class="evaluation-section">
              <div class="evaluation-header">
                <h3>Capacity Evaluation</h3>
                <div class="overall-rating">
                  <span class="overall-label">Overall Rating</span>
                  <div class="overall-value">{{ evaluationForm.get('overallRating')?.value || calculateOverallRating() }}/60</div>
                </div>
              </div>
              
              <!-- Personal and Ethical Aspects Section -->
              <h4 class="evaluation-category-title">First: Personal and Ethical Aspects of the Trainee</h4>
              <div class="modern-rating-grid">
                <!-- Neat Appearance -->
                <div class="modern-rating-item">
                  <div class="rating-header">
                    <label>Has a neat appearance and high ethical standards</label>
                    <span class="rating-value">{{ evaluationForm.get('neatAppearance')?.value || 0 }}/3</span>
                  </div>
                  <div class="rating-slider">
                    <input type="range" class="modern-range" min="0" max="3" step="1" formControlName="neatAppearance">
                    <div class="rating-track">
                      <div class="rating-fill" [style.width.%]="(evaluationForm.get('neatAppearance')?.value / 3) * 100"></div>
                    </div>
                  </div>
                </div>
                
                <!-- Responsive Personality -->
                <div class="modern-rating-item">
                  <div class="rating-header">
                    <label>Has a responsive and reliable personality</label>
                    <span class="rating-value">{{ evaluationForm.get('responsivePersonality')?.value || 0 }}/3</span>
                  </div>
                  <div class="rating-slider">
                    <input type="range" class="modern-range" min="0" max="3" step="1" formControlName="responsivePersonality">
                    <div class="rating-track">
                      <div class="rating-fill" [style.width.%]="(evaluationForm.get('responsivePersonality')?.value / 3) * 100"></div>
                    </div>
                  </div>
                </div>
                
                <!-- Confident Relations -->
                <div class="modern-rating-item">
                  <div class="rating-header">
                    <label>Confident and maintains good relations with others</label>
                    <span class="rating-value">{{ evaluationForm.get('confidentRelations')?.value || 0 }}/3</span>
                  </div>
                  <div class="rating-slider">
                    <input type="range" class="modern-range" min="0" max="3" step="1" formControlName="confidentRelations">
                    <div class="rating-track">
                      <div class="rating-fill" [style.width.%]="(evaluationForm.get('confidentRelations')?.value / 3) * 100"></div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Practical and Professional Aspects Section -->
              <h4 class="evaluation-category-title">Second: Practical and Professional Aspects of the Trainee</h4>
              <div class="modern-rating-grid">
                <!-- Attendance -->
                <div class="modern-rating-item">
                  <div class="rating-header">
                    <label>Regular attendance and punctuality during training</label>
                    <span class="rating-value">{{ evaluationForm.get('attendance')?.value || 0 }}/15</span>
                  </div>
                  <div class="rating-slider">
                    <input type="range" class="modern-range" min="0" max="15" step="1" formControlName="attendance">
                    <div class="rating-track">
                      <div class="rating-fill" [style.width.%]="(evaluationForm.get('attendance')?.value / 15) * 100"></div>
                    </div>
                  </div>
                </div>
                
                <!-- Understanding Instructions -->
                <div class="modern-rating-item">
                  <div class="rating-header">
                    <label>Understanding and executing instructions within the training scope</label>
                    <span class="rating-value">{{ evaluationForm.get('understandingInstructions')?.value || 0 }}/3</span>
                  </div>
                  <div class="rating-slider">
                    <input type="range" class="modern-range" min="0" max="3" step="1" formControlName="understandingInstructions">
                    <div class="rating-track">
                      <div class="rating-fill" [style.width.%]="(evaluationForm.get('understandingInstructions')?.value / 3) * 100"></div>
                    </div>
                  </div>
                </div>
                
                <!-- Task Completion -->
                <div class="modern-rating-item">
                  <div class="rating-header">
                    <label>Level of completion of tasks assigned during training</label>
                    <span class="rating-value">{{ evaluationForm.get('taskCompletion')?.value || 0 }}/3</span>
                  </div>
                  <div class="rating-slider">
                    <input type="range" class="modern-range" min="0" max="3" step="1" formControlName="taskCompletion">
                    <div class="rating-track">
                      <div class="rating-fill" [style.width.%]="(evaluationForm.get('taskCompletion')?.value / 3) * 100"></div>
                    </div>
                  </div>
                </div>
                
                <!-- Effective Interaction -->
                <div class="modern-rating-item">
                  <div class="rating-header">
                    <label>Effectiveness in dealing with colleagues and supervisors during training</label>
                    <span class="rating-value">{{ evaluationForm.get('effectiveInteraction')?.value || 0 }}/3</span>
                  </div>
                  <div class="rating-slider">
                    <input type="range" class="modern-range" min="0" max="3" step="1" formControlName="effectiveInteraction">
                    <div class="rating-track">
                      <div class="rating-fill" [style.width.%]="(evaluationForm.get('effectiveInteraction')?.value / 3) * 100"></div>
                    </div>
                  </div>
                </div>
                
                <!-- Follow Up With Supervisor -->
                <div class="modern-rating-item">
                  <div class="rating-header">
                    <label>Student's follow-up with the supervisor and seeking clarifications related to training</label>
                    <span class="rating-value">{{ evaluationForm.get('followUpWithSupervisor')?.value || 0 }}/3</span>
                  </div>
                  <div class="rating-slider">
                    <input type="range" class="modern-range" min="0" max="3" step="1" formControlName="followUpWithSupervisor">
                    <div class="rating-track">
                      <div class="rating-fill" [style.width.%]="(evaluationForm.get('followUpWithSupervisor')?.value / 3) * 100"></div>
                    </div>
                  </div>
                </div>
                
                <!-- Adherence To Instructions -->
                <div class="modern-rating-item">
                  <div class="rating-header">
                    <label>Student's commitment to applying the warnings and instructions given by the supervisor</label>
                    <span class="rating-value">{{ evaluationForm.get('adherenceToInstructions')?.value || 0 }}/3</span>
                  </div>
                  <div class="rating-slider">
                    <input type="range" class="modern-range" min="0" max="3" step="1" formControlName="adherenceToInstructions">
                    <div class="rating-track">
                      <div class="rating-fill" [style.width.%]="(evaluationForm.get('adherenceToInstructions')?.value / 3) * 100"></div>
                    </div>
                  </div>
                </div>
                
                <!-- Report Writing -->
                <div class="modern-rating-item">
                  <div class="rating-header">
                    <label>Effectiveness in writing reports and the final report</label>
                    <span class="rating-value">{{ evaluationForm.get('reportWriting')?.value || 0 }}/10</span>
                  </div>
                  <div class="rating-slider">
                    <input type="range" class="modern-range" min="0" max="10" step="1" formControlName="reportWriting">
                    <div class="rating-track">
                      <div class="rating-fill" [style.width.%]="(evaluationForm.get('reportWriting')?.value / 10) * 100"></div>
                    </div>
                  </div>
                </div>
                
                <!-- Information Gathering -->
                <div class="modern-rating-item">
                  <div class="rating-header">
                    <label>Ability to obtain information from various sources</label>
                    <span class="rating-value">{{ evaluationForm.get('informationGathering')?.value || 0 }}/3</span>
                  </div>
                  <div class="rating-slider">
                    <input type="range" class="modern-range" min="0" max="3" step="1" formControlName="informationGathering">
                    <div class="rating-track">
                      <div class="rating-fill" [style.width.%]="(evaluationForm.get('informationGathering')?.value / 3) * 100"></div>
                    </div>
                  </div>
                </div>
                
                <!-- Adapt To Work Environment -->
                <div class="modern-rating-item">
                  <div class="rating-header">
                    <label>Ability to understand and adapt to the work environment and provide ideas and suggestions</label>
                    <span class="rating-value">{{ evaluationForm.get('adaptToWorkEnvironment')?.value || 0 }}/5</span>
                  </div>
                  <div class="rating-slider">
                    <input type="range" class="modern-range" min="0" max="5" step="1" formControlName="adaptToWorkEnvironment">
                    <div class="rating-track">
                      <div class="rating-fill" [style.width.%]="(evaluationForm.get('adaptToWorkEnvironment')?.value / 5) * 100"></div>
                    </div>
                  </div>
                </div>
                
                <!-- Maintenance Skills -->
                <div class="modern-rating-item">
                  <div class="rating-header">
                    <label>Proficient in maintenance skills</label>
                    <span class="rating-value">{{ evaluationForm.get('maintenanceSkills')?.value || 0 }}/3</span>
                  </div>
                  <div class="rating-slider">
                    <input type="range" class="modern-range" min="0" max="3" step="1" formControlName="maintenanceSkills">
                    <div class="rating-track">
                      <div class="rating-fill" [style.width.%]="(evaluationForm.get('maintenanceSkills')?.value / 3) * 100"></div>
                    </div>
                  </div>
                </div>
              </div>
              
              <form [formGroup]="evaluationForm" (ngSubmit)="submitEvaluation()">
                <!-- Comments Section -->
                <div class="modern-form-group">
                  <label for="comments">Additional Comments</label>
                  <textarea id="comments" formControlName="comments" class="modern-textarea" placeholder="Add any additional comments or observations about the trainee's performance..."></textarea>
                </div>
                
                <div class="modern-form-actions">
                  <button type="submit" class="modern-submit-btn" [disabled]="!evaluationForm.valid">
                    <i class="fas fa-save"></i> Save Evaluation
                    <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    <span *ngIf="!isLoading"><i class="bi bi-check-circle-fill"></i> Submit Evaluation</span>
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-danger" (click)="Delete()" [disabled]="isLoading">
            <span *ngIf="!isLoading">Delete</span>
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          </button>
          <button type="button" class="btn btn-secondary" (click)="close()" [disabled]="isLoading">
            <span *ngIf="!isLoading">Close</span>
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade show"></div>
