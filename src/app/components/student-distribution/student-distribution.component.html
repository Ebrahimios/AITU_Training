<div class="distribution-container">
  <!-- Header -->
  <div class="header">
    <div class="back-button">
      <button class="btn btn-light" routerLink="/home">
        <i class="bi bi-arrow-left"></i>
        {{ translationService.translate('back_to_home') }}
      </button>
    </div>
    <div class="header-content">
      <h2>{{ translationService.translate('students_distribution') }}</h2>
      <div class="filters">
        <div class="search-box">
          <i class="bi bi-search"></i>
          <input 
            type="text" 
            [(ngModel)]="searchTerm" 
            placeholder="Search students..."
          >
        </div>
        
        <select [(ngModel)]="selectedDepartment">
          <option *ngFor="let dept of departments" [value]="dept">
            {{dept}} Department
          </option>
        </select>

        <select [(ngModel)]="selectedStage">
          <option *ngFor="let stage of stages" [value]="stage">
            {{stage}}
          </option>
        </select>

        <select [(ngModel)]="selectedGroup">
          <option *ngFor="let group of groups" [value]="group">
            {{group}}
          </option>
        </select>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content">
    <!-- Students List -->
    <div class="students-list">
      <div class="students-header">
        <h3>Students ({{filteredStudents.length}})</h3>
        <div class="selection-controls">
          <label class="select-all-checkbox">
            <input type="checkbox" 
                   [checked]="selectAll" 
                   (change)="toggleSelectAll()">
            <span>Select All</span>
          </label>
          <div class="selection-info" *ngIf="selectedStudents.length > 0">
            {{selectedStudents.length}} students selected
          </div>
        </div>
      </div>

      <div class="students-container" cdkDropList [cdkDropListData]="filteredStudents" 
           [cdkDropListConnectedTo]="['factory-droplist']" 
           [cdkDropListSortingDisabled]="true">
        <div class="student-card" *ngFor="let student of filteredStudents"
             cdkDrag [cdkDragData]="student"
             [class.selected]="student.selected">
          <div class="checkbox-wrapper">
            <input type="checkbox" 
                   [checked]="student.selected"
                   (click)="toggleSelection($event, student)">
          </div>
          <div class="student-info" (click)="toggleSelection($event, student)">
            <h4>{{student.name}}</h4>
            <p>{{student.department}} | {{student.stage}} | {{student.group}}</p>
          </div>
          <div class="student-factory">
            <span *ngIf="student.factory" class="factory-badge">
              {{student.factory}}
              <button class="remove-btn" (click)="removeFromFactory(student)">
                <i class="bi bi-x"></i>
              </button>
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Factories -->
    <div class="factories-container">
      <div class="factories-header">
        <h3>Factories</h3>
        <div class="factory-search">
          <i class="bi bi-search"></i>
          <input 
            type="text" 
            [(ngModel)]="factorySearchTerm" 
            placeholder="Search factories..."
          >
        </div>
      </div>
      <div class="factories-grid">
        <div class="factory-card" *ngFor="let factory of filteredFactories">
          <div class="factory-header">
            <h4>{{factory.name}}</h4>
            <div class="capacity-badge" [class.full]="factory.assignedStudents >= factory.capacity">
              {{factory.assignedStudents}}/{{factory.capacity}}
            </div>
          </div>
          
          <div class="factory-content">
            <div class="progress-bar">
              <div class="progress" [style.width.%]="(factory.assignedStudents / factory.capacity) * 100"></div>
            </div>
            
            <div class="factory-dropzone" 
                 cdkDropList
                 id="factory-droplist"
                 [cdkDropListData]="factory.students"
                 (cdkDropListDropped)="onDrop($event, factory)"
                 [class.full]="factory.assignedStudents >= factory.capacity">
              <div class="dropzone-content" *ngIf="factory.students.length === 0">
                <i class="bi bi-plus-circle"></i>
                <span *ngIf="factory.assignedStudents < factory.capacity">
                  Drag students here
                </span>
                <span *ngIf="factory.assignedStudents >= factory.capacity">
                  Factory is full
                </span>
              </div>
              
              <!-- Assigned Students -->
              <div class="assigned-students">
                <div class="assigned-student" *ngFor="let student of factory.students">
                  <span class="student-name">{{student.name}}</span>
                  <button class="remove-btn" (click)="removeFromFactory(student)">
                    <i class="bi bi-x"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
